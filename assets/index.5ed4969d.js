import{S as mt}from"./index.c93dfeeb.js";import{e as ft,q as _t,_ as gt}from"./index.0402bd15.js";/* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{d as wt,r as bt,o as Ft,bp as yt,bY as xt,bU as ht,aU as St,bB as Ct,bN as Dt,bC as At,C as g,D as h,aI as u,aH as l,u as Et,aM as m,aN as S,bw as et,G as ot,bx as nt,aK as D,aJ as A,aE as E,n as st,ba as Bt,bX as Vt,aZ as vt,b8 as Tt,bZ as Pt,bD as kt,bM as It}from"./arco.beabb834.js";import{e as I,g as ut,h as i,f as c,s as Ut}from"./serial.b70f48dc.js";import{u as Ot}from"./loading.04079284.js";import"./chart.83b8c11b.js";import"./vue.30c84055.js";const Ht={class:"container"},Nt=["innerHTML"],Mt={name:"Sat"},Yt=wt({...Mt,setup(Lt){const{loading:rt,setLoading:_}=Ot(!0),o=ft(),t=bt({showHide:0,status:"\u70B9\u51FB\u5199\u5165\u6309\u94AE\u5199\u5165\u536B\u661F\u6570\u636E\u5230\u8BBE\u5907<br/><br/>",sat:"",satData:[],lng:0,lat:0,alt:0,tx:0,rx:0,txTone:0,rxTone:0,CTCSSOption:[67,69.3,71.9,74.4,77,79.7,82.5,85.4,88.5,91.5,94.8,97.4,100,103.5,107.2,110.9,114.8,118.8,123,127.3,131.8,136.5,141.3,146.2,151.4,156.7,159.8,162.2,165.5,167.9,171.3,173.8,177.3,179.9,183.5,186.2,189.9,192.8,196.6,199.5,203.5,206.5,210.7,218.1,225.7,229.1,233.6,241.8,250.3,254.1],pass:void 0,passOption:[],dt:"",timer:void 0,passCustom:void 0,dtCustom:void 0,freqDb:[]});Ft(async()=>{const r=await(await fetch("https://mirror.ghproxy.com/https://raw.githubusercontent.com/palewire/ham-satellite-database/main/data/amsat-active-frequencies.json")).text();t.freqDb=JSON.parse(r),t.timer=setInterval(()=>{t.dt=new Date().toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})},1e3)}),yt(()=>{try{clearInterval(t.timer)}catch{}});const lt=async()=>{if(o.connectState!=!0){alert("\u8BF7\u5148\u8FDE\u63A5\u624B\u53F0\uFF01");return}_(!0),await I(o.connectPort),await U(),await ut(o.connectPort),_(!1)},U=async()=>{var n;const r=t.dtCustom?new Date(t.dtCustom):new Date,a=[...i(parseInt(r.getFullYear().toString().substring(2,4)).toString(16)),...i((r.getMonth()+1).toString(16)),...i(r.getDate().toString(16)),...i(r.getHours().toString(16)),...i(r.getMinutes().toString(16)),...i(r.getSeconds().toString(16))];await c(o.connectPort,11200,new Uint8Array(a),6,(n=o.configuration)==null?void 0:n.uart)},it=async r=>{const a=t.satData.find(n=>n.name==r);if(a&&a.path){t.status+="<br/>\u536B\u661F\u53C2\u6570\uFF1A<br/>",a.path.map(e=>{t.status+=e+"<br/>"});let n=!1;t.freqDb.map(e=>{a.path[1].split(" ")[1]==e.norad_id&&e.mode.indexOf("FM")!=-1&&(console.log(e),n=!0,t.tx=e.uplink?parseFloat(e.uplink.split("/")[0]):0,t.rx=e.downlink?parseFloat(e.downlink.split("/")[0]):0,t.txTone=parseFloat([0,...t.CTCSSOption].reduce((d,y)=>e.mode.indexOf(y)!=-1?y:d)))}),n||(t.tx=0,t.rx=0,t.txTone=0,t.rxTone=0)}st(()=>{const n=document==null?void 0:document.getElementById("statusArea");n&&(n.scrollTop=n==null?void 0:n.scrollHeight)})};(async()=>{_(!0);const a=(await(await fetch("https://celestrak.org/NORAD/elements/amateur.txt")).text()).split(/\r?\n/),n=[];let e={};for(let d=0;d<a.length;d++)Number.isNaN(parseInt(a[d].substring(0,1)))?(e.name&&e.name!=""&&(n.push(e),e={}),e.name=a[d]):(e.path||(e.path=[]),e.path.push(a[d]));t.satData=n,_(!1)})();const O=async()=>{_(!0),navigator.geolocation.getCurrentPosition(r=>{r.coords&&(t.lat=r.coords.latitude,t.lng=r.coords.longitude,r.coords.altitude&&(t.alt=r.coords.altitude))}),_(!1)};O();const pt=async(r=0,a)=>{var n;await I(o.connectPort);for(let e=r;e<a.length+r;e+=128)await c(o.connectPort,e,a.slice(e-r,e-r+128),128,(n=o.configuration)==null?void 0:n.uart),t.status=t.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A"+((e-r)/a.length*100).toFixed(1)+"%<br/>",st(()=>{const d=document==null?void 0:document.getElementById("statusArea");d&&(d.scrollTop=d==null?void 0:d.scrollHeight)});t.status=t.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A100.0%<br/>"},ct=async()=>{if(!t.sat){alert("\u8BF7\u9009\u62E9\u536B\u661F\uFF01");return}_(!0);const r=await(await fetch("https://k5.vicicode.com/api/pass",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({sat:t.sat,sat_line_1:t.satData.find(n=>n.name==t.sat).path[0],sat_line_2:t.satData.find(n=>n.name==t.sat).path[1],lat:t.lat,lng:t.lng,alt:t.alt})})).json(),a=[];for(let n=0;n<r.pass_times.length;n++)try{let e;Date.parse(r.departure_times[n])-Date.parse(r.pass_times[n])>0?e=[r.pass_times[n],r.departure_times[n]]:e=[r.pass_times[n],r.departure_times[n+1]],a.push(e)}catch{}a.length>0?t.pass=a[0][0]+"|"+a[0][1]:t.pass=void 0,t.passOption=a,_(!1)},dt=async()=>{var H,N,M,Y,L,q,j,R,J,$,z,Z,G,K,X,Q,W,tt;if(o.connectState!=!0){alert("\u8BF7\u5148\u8FDE\u63A5\u624B\u53F0\uFF01");return}if(((H=o.configuration)==null?void 0:H.sat)!=!0){alert("\u56FA\u4EF6\u7248\u672C\u4E0D\u5339\u914D");return}if(!t.sat){alert("\u8BF7\u9009\u62E9\u536B\u661F\uFF01");return}if(t.passCustom&&(t.pass=t.passCustom[0]+"|"+t.passCustom[1]),!t.pass){alert("\u8BF7\u9009\u62E9\u8FC7\u5883\u65F6\u95F4\uFF01");return}_(!0);const r=await(await fetch("https://k5.vicicode.com/api/doppler",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({sat:t.sat,sat_line_1:t.satData.find(F=>F.name==t.sat).path[0],sat_line_2:t.satData.find(F=>F.name==t.sat).path[1],lat:t.lat,lng:t.lng,alt:t.alt,tx:t.tx,rx:t.rx,pass_time:t.pass.split("|")[0],departure_time:t.pass.split("|")[1]})})).json(),a=t.sat,n=t.pass.split("|")[0],e=n.split("-")[0].substring(2,4),d=n.split("-")[1],y=n.split("-")[2].split(" ")[0],w=n.split(" ")[1].split(":")[0],x=n.split(" ")[1].split(":")[1],b=n.split(" ")[1].split(":")[2],f=t.pass.split("|")[1],B=f.split("-")[0].substring(2,4),V=f.split("-")[1],v=f.split("-")[2].split(" ")[0],T=f.split(" ")[1].split(":")[0],P=f.split(" ")[1].split(":")[1],k=f.split(" ")[1].split(":")[2];await I(o.connectPort);let p=new Uint8Array(10);p.set(Ut(a.trim()).subarray(0,9)),await c(o.connectPort,11168,p,10,(N=o.configuration)==null?void 0:N.uart),await c(o.connectPort,11178,i(parseInt(e).toString(16)).subarray(0,1),1,(M=o.configuration)==null?void 0:M.uart),await c(o.connectPort,11179,i(parseInt(d).toString(16)).subarray(0,1),1,(Y=o.configuration)==null?void 0:Y.uart),await c(o.connectPort,11180,i(parseInt(y).toString(16)).subarray(0,1),1,(L=o.configuration)==null?void 0:L.uart),await c(o.connectPort,11181,i(parseInt(w).toString(16)).subarray(0,1),1,(q=o.configuration)==null?void 0:q.uart),await c(o.connectPort,11182,i(parseInt(x).toString(16)).subarray(0,1),1,(j=o.configuration)==null?void 0:j.uart),await c(o.connectPort,11183,i(parseInt(b).toString(16)).subarray(0,1),1,(R=o.configuration)==null?void 0:R.uart),await c(o.connectPort,11184,i(parseInt(B).toString(16)).subarray(0,1),1,(J=o.configuration)==null?void 0:J.uart),await c(o.connectPort,11185,i(parseInt(V).toString(16)).subarray(0,1),1,($=o.configuration)==null?void 0:$.uart),await c(o.connectPort,11186,i(parseInt(v).toString(16)).subarray(0,1),1,(z=o.configuration)==null?void 0:z.uart),await c(o.connectPort,11187,i(parseInt(T).toString(16)).subarray(0,1),1,(Z=o.configuration)==null?void 0:Z.uart),await c(o.connectPort,11188,i(parseInt(P).toString(16)).subarray(0,1),1,(G=o.configuration)==null?void 0:G.uart),await c(o.connectPort,11189,i(parseInt(k).toString(16)).subarray(0,1),1,(K=o.configuration)==null?void 0:K.uart),p=new Uint8Array(2),p.set(i(((Date.parse(f)-Date.parse(n))/1e3).toString(16)).subarray(0,2)),await c(o.connectPort,11190,p,2,(X=o.configuration)==null?void 0:X.uart),p=new Uint8Array(2),t.txTone&&t.txTone>0&&p.set(i(parseInt((t.txTone*10).toFixed(0)).toString(16)).subarray(0,2)),await c(o.connectPort,11192,p,2,(Q=o.configuration)==null?void 0:Q.uart),p=new Uint8Array(2),t.rxTone&&t.rxTone>0&&p.set(i(parseInt((t.rxTone*10).toFixed(0)).toString(16)).subarray(0,2)),await c(o.connectPort,11194,p,2,(W=o.configuration)==null?void 0:W.uart),p=new Uint8Array(4),p.set(i(((Date.parse(n)-Date.parse("2000-01-01 00:00:00"))/1e3).toString(16)).subarray(0,4)),await c(o.connectPort,11196,p,4,(tt=o.configuration)==null?void 0:tt.uart);const s=[];r.shift_array.filter((F,C)=>C%2===0).map(F=>{const C=new Uint8Array(4),at=new Uint8Array(4);C.set(i(parseInt(((t.tx*1e6+F[0])/10).toFixed(0)).toString(16))),at.set(i(parseInt(((t.rx*1e6+F[1])/10).toFixed(0)).toString(16))),s.push(...C,...at)}),p=new Uint8Array(7680),p.set(new Uint8Array(s).subarray(0,7680)),await pt(123392,p),await U(),await ut(o.connectPort),_(!1)};return(r,a)=>{const n=_t,e=Bt,d=xt,y=mt,w=Vt,x=ht,b=St,f=vt,B=Tt,V=Pt,v=Ct,T=Dt,P=At,k=kt,p=It;return g(),h("div",Ht,[u(n,{items:["\u5C0F\u5DE5\u5177","\u536B\u661F\u5199\u5165"]}),u(p,{gutter:20,align:"stretch"},{default:l(()=>[u(k,{span:24},{default:l(()=>[u(P,{class:"general-card",title:"\u536B\u661F\u5199\u5165"},{default:l(()=>[u(T,{loading:Et(rt),style:{width:"100%"},tip:"\u6B63\u5728\u5904\u7406 ..."},{default:l(()=>[u(e,{"label-col-style":{width:"25%"},field:"dt",label:"\u6D4F\u89C8\u5668\u65F6\u95F4",onClick:a[0]||(a[0]=()=>{t.showHide+=1})},{default:l(()=>[m(S(t.dt),1)]),_:1}),et(u(e,{"label-col-style":{width:"25%"},field:"dtCustom",label:"\u81EA\u5B9A\u4E49\u65F6\u95F4"},{default:l(()=>[ot("div",null,[u(d,{style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"","time-picker-props":{defaultValue:"00:00:00"},format:"YYYY-MM-DD HH:mm:ss",modelValue:t.dtCustom,"onUpdate:modelValue":a[1]||(a[1]=s=>t.dtCustom=s)},null,8,["modelValue"]),m(" \xA0\xA0"),u(y,{size:"small",theme:"success",onClick:lt},{default:l(()=>[m("\u5199\u5165\u65F6\u95F4\u5230\u53F0\u7AD9")]),_:1})])]),_:1},512),[[nt,t.showHide>=5]]),u(e,{"label-col-style":{width:"25%"},field:"sat",label:"\u9009\u62E9\u536B\u661F"},{default:l(()=>[u(x,{modelValue:t.sat,"onUpdate:modelValue":a[2]||(a[2]=s=>t.sat=s),onChange:it,placeholder:"\u9009\u62E9\u536B\u661F ...","allow-search":"","allow-clear":""},{default:l(()=>[(g(!0),h(D,null,A(t.satData,s=>(g(),E(w,{key:s.name,value:s.name},{default:l(()=>[m(S(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"lng",label:"\u53F0\u7AD9\u7ECF\u5EA6"},{default:l(()=>[u(b,{precision:6,modelValue:t.lng,"onUpdate:modelValue":a[3]||(a[3]=s=>t.lng=s)},null,8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"lat",label:"\u53F0\u7AD9\u7EAC\u5EA6"},{default:l(()=>[u(b,{precision:6,modelValue:t.lat,"onUpdate:modelValue":a[4]||(a[4]=s=>t.lat=s)},null,8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"alt",label:"\u53F0\u7AD9\u6D77\u62D4"},{default:l(()=>[u(b,{precision:0,modelValue:t.alt,"onUpdate:modelValue":a[5]||(a[5]=s=>t.alt=s)},null,8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},label:""},{default:l(()=>[u(B,null,{default:l(()=>[u(f,{onClick:O},{default:l(()=>[m("\u6D4F\u89C8\u5668\u83B7\u53D6\u7ECF\u7EAC\u5EA6")]),_:1}),u(f,{onClick:ct},{default:l(()=>[m("\u83B7\u53D6\u536B\u661F\u8FC7\u5883\u65F6\u95F4")]),_:1})]),_:1})]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"pass",label:"\u9009\u62E9\u8FC7\u5883\u65F6\u95F4"},{default:l(()=>[u(x,{modelValue:t.pass,"onUpdate:modelValue":a[6]||(a[6]=s=>t.pass=s),"allow-search":"","allow-clear":""},{default:l(()=>[(g(!0),h(D,null,A(t.passOption,s=>(g(),E(w,{key:s[0]+"|"+s[1],value:s[0]+"|"+s[1]},{default:l(()=>[m(S(s[0]+" - "+s[1]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),et(u(e,{"label-col-style":{width:"25%"},field:"passCustom",label:"\u81EA\u5B9A\u4E49\u8FC7\u5883\u65F6\u95F4"},{default:l(()=>[u(V,{style:{width:"360px",margin:"0 24px 24px 0"},"show-time":"","time-picker-props":{defaultValue:["00:00:00","00:00:00"]},format:"YYYY-MM-DD HH:mm:ss",modelValue:t.passCustom,"onUpdate:modelValue":a[7]||(a[7]=s=>t.passCustom=s)},null,8,["modelValue"])]),_:1},512),[[nt,t.showHide>=5]]),u(e,{"label-col-style":{width:"25%"},field:"tx",label:"\u4E0A\u884C\u9891\u7387"},{default:l(()=>[u(b,{precision:5,modelValue:t.tx,"onUpdate:modelValue":a[8]||(a[8]=s=>t.tx=s)},null,8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"txTone",label:"\u4E0A\u884C\u4E9A\u97F3"},{default:l(()=>[u(x,{modelValue:t.txTone,"onUpdate:modelValue":a[9]||(a[9]=s=>t.txTone=s),"allow-search":"","allow-clear":""},{default:l(()=>[u(w,{value:0},{default:l(()=>[m("\u5173\u95ED")]),_:1}),(g(!0),h(D,null,A(t.CTCSSOption,s=>(g(),E(w,{key:s,value:s},{default:l(()=>[m(S(s.toFixed(1)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"rx",label:"\u4E0B\u884C\u9891\u7387"},{default:l(()=>[u(b,{precision:5,modelValue:t.rx,"onUpdate:modelValue":a[10]||(a[10]=s=>t.rx=s)},null,8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},field:"rxTone",label:"\u4E0B\u884C\u4E9A\u97F3"},{default:l(()=>[u(x,{modelValue:t.rxTone,"onUpdate:modelValue":a[11]||(a[11]=s=>t.rxTone=s),"allow-search":"","allow-clear":""},{default:l(()=>[u(w,{value:0},{default:l(()=>[m("\u5173\u95ED")]),_:1}),(g(!0),h(D,null,A(t.CTCSSOption,s=>(g(),E(w,{key:s,value:s},{default:l(()=>[m(S(s.toFixed(1)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(e,{"label-col-style":{width:"25%"},label:""},{default:l(()=>[u(f,{onClick:dt},{default:l(()=>[m("\u5199\u5165\u6570\u636E")]),_:1})]),_:1}),u(v),ot("div",{id:"statusArea",style:{height:"20em","background-color":"azure",color:"silver",overflow:"auto",padding:"20px"},innerHTML:t.status},null,8,Nt)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})])}}});const ua=gt(Yt,[["__scopeId","data-v-5eea2455"]]);export{ua as default};
